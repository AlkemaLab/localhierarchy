[{"path":"https://alkemalab.github.io/localhierarchy/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2025 localhierarchy authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/articles/localhierarchy_article.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"[Article] localhierarchy: an R package to facilitate fitting of global and local Bayesian hierarchical models","text":"global health estimation, Bayesian hierarchical models become cornerstone methodology, enabling integration diverse data sources produce reliable estimates across multiple populations regions. example, used estimate forecast family planning indicators FP2030 initiative (Alkema et al. 2024), incidence low birth weight (Okwaraji et al. 2024), abortion unintended pregnancies rates (Bearak et al. 2020), maternal mortality United Nations Interagency Group (Peterson et al. 2024). efforts, national subnational estimates often required population-periods limited data availability. contexts, Bayesian hierarchical models -— whether used directly specific components within larger modeling frameworks – valuable facilitate sharing information across populations. Global modeling exercises typically fit Bayesian hierarchical models comprehensive global databases, producing national-level estimates countries worldwide. facilitate analysis single population, often desirable use models informed global models can fitted just subset data, data single country. refer local models: models derived global hierarchical models adapted fit using data one population. Beyond allowing model fitting smaller, specific datasets, local models offer practical advantages faster computation, making feasible users perform analyses quickly computers. Additionally, local models enable estimates different populations updated independently, example, new data become available. approach used successfully global estimation exercises family planning maternal mortality (Alkema et al. 2024; Peterson et al. 2024). key challenge use local models global health estimation synchronizing codebases data flows global local estimation approaches. Synchronization important fitting local models relies parameter estimates global models. Therefore, synchronization necessary ensure consistency across global local models. can particularly challenging modeling approaches involve hierarchical estimation multiple parameters, hierarchical structures may differ across parameters. paper introduces R package designed address challenges supporting development fitting Bayesian hierarchical models settings requiring global local estimation. package provides R functions Stan functions model blocks (Stan Development Team 2025) facilitate specification hierarchical models, fit full global models, subsequently fit local models using fixed parameter values inferred global analysis. framework, users can conveniently perform local inference informed global context, streamlining workflows global health estimation tasks. article presents practical introduction package (Alkema et al. 2025) along illustrative case studies demonstrating applicability. article organized follows. next section introduces modeling approach workflow used estimating family planning indicators, motivating need functionality fitting global local hierarchical models. methods section introduces package’s functionality estimation one parameter national level. Finally, return case study family planning estimation present illustrative results application setup context.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/articles/localhierarchy_article.html","id":"sec-fpet","dir":"Articles","previous_headings":"","what":"The Family Planning Estimation Tool (FPET)","title":"[Article] localhierarchy: an R package to facilitate fitting of global and local Bayesian hierarchical models","text":"motivate utility use package, focus Family Planning Estimation Tool (FPET) illustrative example (Alkema et al. 2024). FPET widely used estimate key family planning indicators countries regions. Key indicators include modern contraceptive use, demand family planning, demand satisfied, referring ratio modern contraceptive use demand. Data indicators available household surveys routine data systems. FPET estimates obtained fitting Bayesian model available data. illustration FPET estimates available data shown (fig-localfits?) three countries Western Africa. core, Bayesian FPET model employs transition models demand demand satisfied characterize long-term trajectories family planning indicators time within population (Susmann Alkema 2025), illustrated (fig-transition?). transition model describes changes indicator terms three principal parameters: rate change, timing transition, asymptotic level (maximum attainable level indicator). allow population-specific variation family planning indicators evolve, parameters transition model population-specific. Given limited country-specific information parameters, Bayesian hierarchical models used share information populations, using hierarchical structures one illustrated (fig-hierstruc?). Specifically family planning estimation forecasting, hierarchical model used estimate level demand reference year asymptote transition demand low high values. (fig-level?) shows estimates level reference year country level countries Western Africa, groupings used hierarchical model. (fig-asympt?) shows estimates asymptote. figures show variation levels among countries Western Africa, informed country-specific data. Estimates asymptotes similar across countries Western Africa countries yet reached end phase transition. asymptotes Western African countries informed estimate asymptote sub-Saharan Africa hierarchical model. workflow used FPET produce country-level estimates follows. First, full Bayesian model fit global data base survey data. Data base compilation carried United Nations Population Division (see UNPD world contraceptive use website) Track20 project (see www.track20.org). global model fit provides information model parameters, including hierarchical parameters, e.g., estimates asymptotes. Subsequently, local model can used produce FP estimates based data one country, using information global model fit. technical details approach given next section. return application estimating family planning indicators (sec-fpetnat?).","code":""},{"path":"https://alkemalab.github.io/localhierarchy/articles/localhierarchy_article.html","id":"methods","dir":"Articles","previous_headings":"","what":"Methods","title":"[Article] localhierarchy: an R package to facilitate fitting of global and local Bayesian hierarchical models","text":"modeling approach introduced localhierarchy motivated applications like FPET depend hierarchical structures associated national subnational level estimation, requiring global local models fit. section, introduce principle setup used global local hierarchical models context national estimation. use general notation specific example.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/articles/localhierarchy_article.html","id":"hierarchical-model-specification","dir":"Articles","previous_headings":"Methods","what":"Hierarchical model specification","title":"[Article] localhierarchy: an R package to facilitate fitting of global and local Bayesian hierarchical models","text":"Suppose want estimate population parameter μr(l)\\mu_r^{(l)} interest, referring population health indicator region rr level ll hierarchy. example, indicator refer population health indicator service coverage morbidity mortality-related outcomes. given level ll, index rr refers population particular region indexed rr, example, subnational region, country, group countries. assume μ\\mu unconstrained (possibly transformation applied) consider following general hierarchical model setup (see (fig-hiermodel?)): μr(l)∣μr′(l−1),σl∼N(μr′(l−1),σl2), l>0,\\begin{align*}   \\mu_{r}^{(l)} \\mid \\mu^{(l-1)}_{r^\\prime}, \\sigma_l &\\sim N(\\mu^{(l-1)}_{r^\\prime}, \\sigma_l^2), \\text{ } l > 0, \\end{align*} μr′(l−1)\\mu^{(l-1)}_{r^\\prime} parameter value one level higher hierarchy region r′r^\\prime contains unit rr. parameter σl\\sigma_l l>0l > 0 describes variability values parameter μ\\mu across geographic units level ll hierarchy. top level hierarchy, l=0l = 0, single parameter estimated. specific example, consider estimation country-specific parameters, countries organized subregions countries (illustrated Figure ). setting, using alternative notation setup indicate level name, hierarchical model can written follows: μc(country)∣μs[c](subregion),σcountry2∼N(μs[c](subregion),σcountry2),μs(subregion)∣μw[s](region),σsubregion2∼N(μw[s](region),σsubregion2),μw(region)∣μ(global),σregion2∼N(μ(global),σregion2),\\begin{alignat}{2}   \\mu_c^{(\\mathrm{country})} &\\mid \\mu_{s[c]}^{(\\mathrm{subregion})}, \\sigma_{ \\mathrm{country}}^2 &&\\sim N(\\mu_{s[c]}^{(\\mathrm{subregion})}, \\sigma_{ \\mathrm{country}}^2), \\label{eq-countryhier} \\\\   \\mu_s^{(\\mathrm{subregion})} &\\mid \\mu_{w[s]}^{(\\mathrm{region})}, \\sigma_{ \\mathrm{subregion}}^2 &&\\sim N(\\mu_{w[s]}^{(\\mathrm{region})}, \\sigma_{\\mathrm{subregion}}^2), \\nonumber \\\\   \\mu_w^{(\\mathrm{region})} &\\mid \\mu^{(\\mathrm{global})}, \\sigma_{ \\mathrm{region}}^2 &&\\sim N(\\mu^{(\\mathrm{global})}, \\sigma_{ \\mathrm{region}}^2), \\nonumber \\end{alignat} c=1,…,Cc =1,\\dots,C refers country index, s[c]=1,..,Ss[c] = 1, .., S subregion index country cc, w[s[c]]=1,..,Ww[s[c]] = 1, .., W region index subregion s[c]s[c]. parameter μ(global)\\mu^{(\\mathrm{global})} global mean parameter interest, e.g., global mean service coverage mortality. parameters σcountry\\sigma_{ \\mathrm{country}}, σsubregion\\sigma_{ \\mathrm{subregion}}, σregion\\sigma_{ \\mathrm{region}} describe variability parameter interest across countries, subregions, regions, respectively.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/articles/localhierarchy_article.html","id":"local-hierarchical-models","dir":"Articles","previous_headings":"Methods","what":"Local hierarchical models","title":"[Article] localhierarchy: an R package to facilitate fitting of global and local Bayesian hierarchical models","text":"use term local hierarchical models refer hierarchical model subset parameters fixed posterior mean estimates obtained fit model larger data set. typical workflow local estimation national level outcomes illustrated (fig-workflow?). national estimation using model given Eq., user starts fitting global model, using global data base estimating parameters hierarchical model. local model, data one country used parameters country-specific fixed using parameter estimates global model fit. local model derived global one fixing parameters. Continuing specific example, example local model produce country estimates using data one country alone following setup: μc(country)∼N(μ̂s[c](subregion),σ̂country2),\\mu_c^{(\\mathrm{country})} \\sim N(\\hat{\\mu}_{s[c]}^{(\\mathrm{subregion})}, \\hat{\\sigma}_{ \\mathrm{country}}^2), replacing hierarchical mean variances point estimates μ̂s[c](subregion)\\hat{\\mu}_{s[c]}^{(\\mathrm{subregion})} σ̂country2\\hat{\\sigma}_{\\mathrm{country}}^2, respectively. Details given implementation section. localhierachy package provides general implementation local models facilitating fixing subsets parameters. Continuing general notation introduced , package, local model one parameter level ll derived fixing σk\\sigma_k k=1,...,lk=1, ..., l fixing μ⋅(k)\\mu_{\\cdot}^{(k)} k=1,..,l−1k = 1, .., l-1 posterior means derived global fit. generally, model fitted using data level ll, user can create local model fixing σk\\sigma_k levels kk chosen level KσK_{\\sigma}. Similarly, μ(k)\\mu^{(k)} parameters can fixed levels kk level Kμ≤KσK_{\\mu} \\leq K_{\\sigma}.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/articles/localhierarchy_article.html","id":"sec-implementation","dir":"Articles","previous_headings":"Methods","what":"Implementation","title":"[Article] localhierarchy: an R package to facilitate fitting of global and local Bayesian hierarchical models","text":"localhierarchy R package contains R functions example Stan model files fit global local hierarchical models. package set allow users incorporate global-local hierarchy setup project. given parameter hierarchical model specification, package functions enable processing data produce Stan input data global local models, Stan model components work global well local models, R functions post-processing model outputs check results produce summary files global models use local models. typical work flow, user first fits global model, followed local ones. worked example given use case (sec-nationalusecase?). global local models examples fitted using localhierarchy wrapper function fit_model_localhierarchy, using arguments specify hierarchical model, data, , local fits, output global model. wrapper function calls R functions process data prepare Stan input data, read Stan model, fit model, post-process results. package includes user-friendly specification hierarchical model structures, associated specification fixed parameters local runs. worked example given (sec-nationalusecase?). Briefly, user wants specify hierarchical model levels world, regions, subregion, country,  using dataset information groupings, naming region, subregion, country, R functions, user can specify hierarchical model follows: first level intercept, global mean, followed region, subregion, country levels. user can specify local model one country fixing parameters different levels, using hierarchical_sigmas_fixed hierarchical_terms_fixed arguments fit_model_localhierarchy function. example, σ\\sigma parameters fixed country level μ\\mu terms fixed subregion, user can encode follows: Note even though σ\\sigma intercept level, term always included hierarchical_sigmas_fixed vector. Stan implementation model uses non-centered parameterization. general notation, l>0l>0, non-centered parameterization refers writing mean parameters deviations higher-level group means: μr(l)=μ(l−1)+σl⋅γr(l),\\begin{align*}   \\mu_r^{(l)} &= \\mu^{(l-1)} + \\sigma_l \\cdot \\gamma_{r}^{(l)}, \\end{align*} γr(l)∼N(0,1)\\gamma_r^{(l)} \\sim N(0, 1). Applied sequentially, μ(0)∼N(0,sglobal)\\mu^{(0)} \\sim N(0,s_{\\mathrm{global}}) prior standard deviation sglobals_{\\mathrm{global}}, get μr(l)=sglobal⋅γ(0)+∑k=1lσk⋅γr′(k),\\begin{align*}   \\mu_r^{(l)} &= s_{\\mathrm{global}}\\cdot\\gamma^{(0)} + \\sum_{k=1}^{l} \\sigma_k \\cdot \\gamma_{r^\\prime}^{(k)}, \\end{align*} r′r^\\prime now refers generally index unit containing lower-level group. specific example country parameters, non-centered parameterization given μc(country)=sglobal⋅γ(global)+σregion⋅γw[s[c]]](region)+σsubregion⋅γs[c](subregion)+σcountry⋅γc(country).\\begin{align*}   \\mu_c^{(\\mathrm{country})} =  s_{\\mathrm{global}} \\cdot {\\gamma}^{(\\mathrm{global})} + {\\sigma}_{\\mathrm{region}}\\cdot {\\gamma}_{w[s[c]]]}^{(\\mathrm{region})} + {\\sigma}_{\\mathrm{subregion}}\\cdot{\\gamma}_{s[c]}^{(\\mathrm{subregion})} + {\\sigma}_{\\mathrm{country}}\\cdot\\gamma_{c}^{(\\mathrm{country})}. \\end{align*} Implementation based model matrix. model given equation , following matrix multiplication used obtain vector μc(country)\\mu_c^{(\\mathrm{country})}s: (μ1(country),...,μc(country))=M⋅(η1,...,η1+R+S+C)′,(\\mu_1^{(\\mathrm{country})}, ..., \\mu_c^{(\\mathrm{country})}) = M\\cdot (\\eta_1, ..., \\eta_{1+R+S+C})', matrix MM sparse matrix 1s 0s, (η1,...,η1+R+S+C)(\\eta_1, ..., \\eta_{1+R+S+C}) refers vector product standard deviation terms γ\\gamma terms, .e., η1=sglobal⋅γglobal,η2=σregion⋅γ1(region),...,η1+W+S+C=σcountry⋅γC(country)\\eta_1 = s_{\\mathrm{global}}\\cdot \\gamma_{\\mathrm{global}}, \\eta_2 = \\sigma_{ \\mathrm{region}} \\cdot \\gamma_{ 1}^{(\\mathrm{region})}, ..., \\eta_{1+W+S+C} = \\sigma_{ \\mathrm{country}}\\cdot\\gamma_{ C}^{(\\mathrm{country})}. estimating subset parameters local model, values σ\\sigmas γ\\gammas fixed point estimates (posterior means) global fit. example, local national model, get μc=sglobal⋅γ̂global+σ̂region⋅γ̂w[s[c]]](region)+σ̂subregion⋅γ̂s[c](subregion)+σ̂country⋅γc(country).\\begin{align*}   \\mu_c = s_{\\mathrm{global}} \\cdot \\hat{\\gamma}_{\\mathrm{global}} +            \\hat{\\sigma}_{ \\mathrm{region}} \\cdot \\hat{\\gamma}_{w[s[c]]]}^{(\\mathrm{region})} +            \\hat{\\sigma}_{ \\mathrm{subregion}} \\cdot \\hat{\\gamma}_{s[c]}^{(\\mathrm{subregion})} +            \\hat{\\sigma}_{ \\mathrm{country}} \\cdot \\gamma_{c}^{(\\mathrm{country})}. \\end{align*}","code":"hierarchical_level <- c(\"intercept\",  \"region\", \"subregion\", \"country\") hierarchical_sigmas_fixed <- c(\"intercept\",  \"region\", \"subregion\", \"country\") hierarchical_terms_fixed <- c(\"intercept\",  \"region\", \"subregion\")"},{"path":"https://alkemalab.github.io/localhierarchy/articles/localhierarchy_article.html","id":"operation","dir":"Articles","previous_headings":"Methods","what":"Operation","title":"[Article] localhierarchy: an R package to facilitate fitting of global and local Bayesian hierarchical models","text":"localhierarchy publicly available R package stored Github. usage, installation R (≥4.5.1), Stan (≥2.37.0), CmdStanR (≥ 0.9.0) required (R Core Team 2025; Stan Development Team 2025; Gabry et al. 2025). localhierarchy package can installed Github repository. Package dependencies listed package DESCRIPTION file automatically installed upon installing main package. minimum RAM, CPU, HARDDRIVE requirements apart necessary store model runs, varies case--case.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/articles/localhierarchy_article.html","id":"sec-nationalusecase","dir":"Articles","previous_headings":"","what":"Use case: National estimation","title":"[Article] localhierarchy: an R package to facilitate fitting of global and local Bayesian hierarchical models","text":"present detailed use case localhierarchy package using simulated data, followed application functionality FPET.","code":""},{"path":[]},{"path":"https://alkemalab.github.io/localhierarchy/articles/localhierarchy_article.html","id":"simulation-setup","dir":"Articles","previous_headings":"Use case: National estimation > Detailed example using simulated data","what":"Simulation setup","title":"[Article] localhierarchy: an R package to facilitate fitting of global and local Bayesian hierarchical models","text":"simulation setup follows: national level estimation, consider countries grouped world, .e., μc(country)|μ(global),σcountry∼N(μ(global),σcountry2).\\mu_c^{(\\mathrm{country})}|\\mu^{(\\mathrm{global})}, \\sigma_{ \\mathrm{country}} \\sim N(\\mu^{(\\mathrm{global})}, \\sigma_{ \\mathrm{country}}^2). likelihood function national data given normal likelihood constant variance: yi(country)|μc[](country),σy2∼N(μc[](country),σy2),y_i^{(\\mathrm{country})}|\\mu_{c[]}^{(\\mathrm{country})}, \\sigma_y^2 \\sim N(\\mu_{c[]}^{(\\mathrm{country})}, \\sigma_y^2), c[]c[] refers country country observation ii. chose simple normal densities data generating mechanisms simulation, focus modeling hierarchical model localhierarchy functionality opposed data model aspects modeling. practice, data model can set user reflect actual data generating mechanisms, example, using binomial likelihood, considering transformed outcomes, accounting sampling errors observations obtained complex survey design. Simulated data generated using simulate_multilevel_data function. simulate set model parameters, setting μ(global)=0\\mu^{(\\mathrm{global})} = 0, σcountry=0.5\\sigma_{\\mathrm{country}} = 0.5, creating 30 countries, national data, using σy=0.1\\sigma_y = 0.1. simulated data, level1 refers country level. data sets contain simulated parameters (eta; deviation away global mean) data (y):","code":"dat_nat |> dplyr::select(level1,  mu_global, level1_eta, y) ## # A tibble: 6,000 × 4 ##    level1 mu_global level1_eta     y ##    <fct>      <dbl>      <dbl> <dbl> ##  1 1              0      0.293 0.179 ##  2 1              0      0.293 0.323 ##  3 1              0      0.293 0.356 ##  4 1              0      0.293 0.279 ##  5 1              0      0.293 0.254 ##  6 1              0      0.293 0.258 ##  7 1              0      0.293 0.479 ##  8 1              0      0.293 0.178 ##  9 1              0      0.293 0.206 ## 10 1              0      0.293 0.190 ## # ℹ 5,990 more rows"},{"path":"https://alkemalab.github.io/localhierarchy/articles/localhierarchy_article.html","id":"model-fitting","dir":"Articles","previous_headings":"Use case: National estimation > Detailed example using simulated data","what":"Model fitting","title":"[Article] localhierarchy: an R package to facilitate fitting of global and local Bayesian hierarchical models","text":"can fit global local models using fit_model_localhierarchy wrapper function, shown later section. first provide implementation details, using main functions package excerpts Stan model. model fitting, first step specify hierarchical structure, using intercept names included survey data. national level estimation, level1 name used data: Input data processed using function get_geo_unit_index_data. function obtains unique hierarchical groupings input data assigns index c unique grouping: second step processing create hierarchical data object, using function hierarchical_data. function outputs list various components associated parameterization hierarchical parameters, used Stan model post-processing: Elements include model matrix elements used make link columns model matrix, equivalently, indices vector η\\eta, hierarchical groupings. model matrix MM, introduced (sec-implementation?), follows: information passed function hierarchical_param_stan_data produce inputs needed Stan model fitting. function outputs named list Stan input data relevant hierarchical setup: example, setting, estimate one σμ\\sigma_{\\mu}, σμ\\sigma_{\\mu} fixed, recorded n_sigma_estimate n_sigma_fixed elements Stan input data: can use function fit_model_localhierarchy fit model specified far. Details included appendix ((sec-helpfilefitmodel?)). argument runstep used define type model, setting \"global_national\" results fitting model data without fixing parameters. arguments include hierarchical level specification, area, survey data. calling function, print statements used inform user key points related model fit: model fitting, Stan model used global local models. Excerpts Stan model included Appendix 1. global_fit object includes posterior samples metadata fit. post_summ object contains posterior means relevant model parameters. example: local fit can estimated passing global fit object wrapper function including data countries interest. local runs countries, including entire data set, specify fix using runstep argument: local national run runstep = \"local_national\", hierarchical levels taken global fit, non-country-specific parameters fixed. indicated print statements . wrapper function, relevant code excerpts \"local_national\" runs follows: local fit, R functions Stan model used introduced Stan input data updated fix subset parameters. Specifically, producing Stan input data, following function call used: , arguments hierarchical_terms_fixed hierarchical_sigmas_fixed used fix μ\\mu intercept-level σ\\sigmas including country-level. Indeed, comparing outputs function call one global fit, find country σ\\sigma fixed value global fit: addition fixing parameters hierarchical models, non-country-specific parameters can fixed well. example, σy\\sigma_y global parameter fixed posterior mean global run use local runs.","code":"hierarchical_level <- c(\"intercept\",  \"level1\") geo_unit_index <- get_geo_unit_index_data(   dat_nat,   hierarchical_levels = hierarchical_level,   area = \"level1\" ) geo_unit_index ## # A tibble: 30 × 2 ##    level1     c ##    <fct>  <int> ##  1 1          1 ##  2 2          2 ##  3 3          3 ##  4 4          4 ##  5 5          5 ##  6 6          6 ##  7 7          7 ##  8 8          8 ##  9 9          9 ## 10 10        10 ## # ℹ 20 more rows hier_data <- hierarchical_data(geo_unit_index, hierarchical_level) names(hier_data) ## [1] \"model_matrix\" \"n_terms\"      \"n_re\"         \"re_start\"     \"re_end\" dim(hier_data$model_matrix$matrix) ## [1] 30 31 hier_data$model_matrix$matrix[1:10, 1:10] ##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] ##  [1,]    1    1    0    0    0    0    0    0    0     0 ##  [2,]    1    0    1    0    0    0    0    0    0     0 ##  [3,]    1    0    0    1    0    0    0    0    0     0 ##  [4,]    1    0    0    0    1    0    0    0    0     0 ##  [5,]    1    0    0    0    0    1    0    0    0     0 ##  [6,]    1    0    0    0    0    0    1    0    0     0 ##  [7,]    1    0    0    0    0    0    0    1    0     0 ##  [8,]    1    0    0    0    0    0    0    0    1     0 ##  [9,]    1    0    0    0    0    0    0    0    0     1 ## [10,]    1    0    0    0    0    0    0    0    0     0 hier_stan_data <- hierarchical_param_stan_data(   param_name = \"mu\",   param_data = hier_data ) names(hier_stan_data) ##  [1] \"mu_raw_n_terms\"          \"mu_re_start\"             ##  [3] \"mu_re_end\"               \"mu_model_matrix\"         ##  [5] \"mu_n_sigma\"              \"mu_raw_n_terms_fixed\"    ##  [7] \"mu_raw_n_terms_estimate\" \"mu_raw_fixed\"            ##  [9] \"mu_n_sigma_fixed\"        \"mu_n_sigma_estimate\"     ## [11] \"mu_sigma_fixed\" hier_stan_data$mu_n_sigma_estimate ## [1] 1 hier_stan_data$mu_n_sigma_fixed ## [1] 0 global_fit <- fit_model_localhierarchy(   runstep = \"global_national\",   hierarchical_level = hierarchical_level,   area = \"level1\",   survey_df = dat_nat ) ## [1] \"We do a global fit.\" ## [1] \"We don't fix anything\" ## [1] \"Hierarchical levels used for this run:\" ## [1] \"intercept\" \"level1\"    ## [1] \"Hierarchical terms fixed:\" ## NULL ## [1] \"Hierarchical sigmas fixed:\" ## NULL names(global_fit) ## [1] \"stan_data\"          \"geo_unit_index\"     \"y\"                  ## [4] \"area\"               \"hierarchical_level\" \"mu_data\"            ## [7] \"stan_model\"         \"samples\"            \"post_summ\" global_fit$post_summ |>    dplyr::filter(variable_no_index == \"mu_sigma\") ## # A tibble: 1 × 3 ##   variable    postmean variable_no_index ##   <chr>          <dbl> <chr>             ## 1 mu_sigma[1]    0.492 mu_sigma fit_local <- fit_model_localhierarchy(   runstep = \"local_national\",   global_fit = global_fit,   area = \"level1\",   survey_df = dat_nat ) ## [1] \"We use a global fit, and take selected or all settings from there.\" ## [1] \"For hierarchical terms, we fix things up to the 2nd-lowest level.\" ## [1] \"For sigma terms, we fix up to lowest level.\" ## [1] \"We fix data model parameters.\" ## [1] \"Hierarchical levels used for this run:\" ## [1] \"intercept\" \"level1\"    ## [1] \"Hierarchical terms fixed:\" ## [1] \"intercept\" ## [1] \"Hierarchical sigmas fixed:\" ## [1] \"intercept\" \"level1\" hierarchical_level <- global_fit$hierarchical_level hierarchical_level_terms_fixed <-    hierarchical_level[1:(length(hierarchical_level)-1)] hierarchical_level_sigmas_fixed <-    hierarchical_level[1:(length(hierarchical_level))] hier_stan_data_local <- hierarchical_param_stan_data(   param_name = \"mu\",   param_data = hier_data,    # information to fix parameters    global_fit = global_fit,   hierarchical_terms_fixed = hierarchical_level_terms_fixed,    hierarchical_sigmas_fixed = hierarchical_level_sigmas_fixed ) hier_stan_data_local$mu_n_sigma_fixed ## [1] 1 hier_stan_data_local$mu_n_sigma_estimate ## [1] 0 hier_stan_data_local$mu_sigma_fixed ## [1] 0.4915359"},{"path":"https://alkemalab.github.io/localhierarchy/articles/localhierarchy_article.html","id":"processing-model-fits","dir":"Articles","previous_headings":"Use case: National estimation > Detailed example using simulated data","what":"Processing model fits","title":"[Article] localhierarchy: an R package to facilitate fitting of global and local Bayesian hierarchical models","text":"package includes several functions produce check outputs. function posterior_summary_hierparam used summarize posterior draws hierarchical parameters, produce summaries μ\\mu level interest. takes fitted model object parameter name input returns list entry referring one level, results (e.g., estimates μ\\mu estimates) level. obtain results global local model: Example output global model follows: column name includes country names, given simple indices simulation. column quant refers posterior means upper lower bounds 95% credible intervals. can create plots show outputs, example first 4 countries:  plotting results global local models, can check estimates compare values fixed local runs. example, see country estimates compare global local models:  Estimates similar, expected. visualizing higher levels, see parameters fixed local model:  can also create plots γ\\gammas (mu_raws): gives list plots, including summary plots plots priors posteriors. example, figures show first 30 γ\\gammas, followed prior-posterior densities first γ\\gamma (referring intercept).   Plots prior posterior densities σ\\sigmas can produced well:","code":"res_global <- posterior_summary_hierparam_localhierarchy(   fit = global_fit, parname = \"mu\") ## [1] \"Calculating posterior summary for hierarchical parameters\" ## [1] \"This can take a little while\" res_local <- posterior_summary_hierparam_localhierarchy(   fit = fit_local, parname = \"mu\") ## [1] \"Calculating posterior summary for hierarchical parameters\" ## [1] \"This can take a little while\" res_local$level1 ## # A tibble: 90 × 3 ##    name      val quant ##    <chr>   <dbl> <dbl> ##  1 1      0.278  0.025 ##  2 1      0.293  0.5   ##  3 1      0.306  0.975 ##  4 2      0.334  0.025 ##  5 2      0.348  0.5   ##  6 2      0.361  0.975 ##  7 3     -0.0779 0.025 ##  8 3     -0.0640 0.5   ##  9 3     -0.0497 0.975 ## 10 4     -0.248  0.025 ## # ℹ 80 more rows plots <- plot_posterior_summaries_localhierarchy(   res = res_global,    modelname1 = \"global\",   hierarchy_select = \"level1\",   areas_select = unique(res_local$level1$name)[1:4] )  plots$level1 plots <- plot_posterior_summaries_localhierarchy(   res = res_local,    modelname1 = \"local\",   res2 = res_global,    modelname2 = \"global\",    hierarchy_select = \"level1\",   areas_select = unique(res_local$level1$name)[1:4] )  plots$level1 plots <- plot_posterior_summaries_localhierarchy(   res = res_local,    modelname1 = \"local\",   res2 = res_global,    modelname2 = \"global\" )  plots$intercept plots <- plot_muraw_localhierarchy(fit = global_fit, parname = \"mu\") plots[[\"summary_plots\"]][[1]] plots[[\"plots_allmuraw\"]][[1]] ## Warning: Multiple drawing groups in `geom_function()` ## ℹ Did you use the correct group, colour, or fill aesthetics? plot_prior_post_sigmas_localhierarchy(fit = global_fit, parname = \"mu\") ## Warning: Multiple drawing groups in `geom_function()` ## ℹ Did you use the correct group, colour, or fill aesthetics?"},{"path":"https://alkemalab.github.io/localhierarchy/articles/localhierarchy_article.html","id":"sec-fpetnat","dir":"Articles","previous_headings":"Use case: National estimation","what":"Application: National estimation of family planning indicators using FPET","title":"[Article] localhierarchy: an R package to facilitate fitting of global and local Bayesian hierarchical models","text":"family planning estimation, local model fitting approach motivated need enable country monitoring evaluation (M&E) officers produce estimates countries, part Track20 project (Alkema et al. 2024). Track20 project works build capacity countries generate use data inform programming, improve impact, accelerate progress toward FP goals. One pillars approach cultivation network M&E officers dedicated increasing quality use FP data. developed family planning estimation tool (FPET) local version global family planning model, use M&E officers. local estimation family planning indicators, Bayesian model described (sec-fpet?) used. Specifically, hierarchical models used estimation transition model parameters. workflow used estimating family planning indicators national level based model fitting several steps, including estimation long-term trends first step, estimation model parameters related modern contraceptive use second step, addition information use traditional methods contraception third step, followed local model fitting produce estimates indicators interest. localhierarchy functionality incorporated family planning modeling code base steps run code base, parameters can passed one model fit another. Full details workflow model specification described elsewhere (Alkema et al. 2024). illustration, (fig-allfits?) shows global local fits modern contraceptive use, demand, demand satisfied selected countries Western Africa. global fit red corresponds closely local fits, shown green. {{< pagebreak >}}","code":""},{"path":"https://alkemalab.github.io/localhierarchy/articles/localhierarchy_article.html","id":"conclusions","dir":"Articles","previous_headings":"","what":"Conclusions","title":"[Article] localhierarchy: an R package to facilitate fitting of global and local Bayesian hierarchical models","text":"Bayesian hierarchical models widely used global health estimation, data availability may vary across national subnational populations. analysis local level, local models often interest, referring models derived global hierarchical models adapted can fitted data one population alone. end, introduced localhierarchy R package, provides functionality fitting Bayesian hierarchical models settings global local estimation required. used localhierarchy functionality multiple projects. discussed estimation family planning indicators, country M&E officers use local model produce estimates national subnational level. area, M&E officers successfully used local models produce national estimates since 2014. Availability local modeling tool enabled users additional analyses check sensitivity estimates specific data sources data quality assumptions. addition fitting model survey data, users local family planning model can also incorporate additional data routine information systems (e.g., number contraceptive commodities supplied family planning facilities, see (Mooney et al. 2024)). use cases illustrate value local models enable local analysis. recently, used localhierarchy approach functionality estimating coverage indicators Countdown 2030 Women’s, Children’s Adolescents’ Health initiative. initiative focuses “tracking progress life-saving interventions Reproductive, Maternal, Newborn, Child Adolescent Health Nutrition” low- middle-income countries, see www. countdown2030.org. developing localhierarchy package providing use cases paper, hope work can useful global health modelers, consider local modeling work.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/articles/localhierarchy_article.html","id":"data-availability-statement","dir":"Articles","previous_headings":"Conclusions","what":"Data availability statement","title":"[Article] localhierarchy: an R package to facilitate fitting of global and local Bayesian hierarchical models","text":"data associated software tool described article.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/articles/localhierarchy_article.html","id":"software-availability","dir":"Articles","previous_headings":"Conclusions","what":"Software availability","title":"[Article] localhierarchy: an R package to facilitate fitting of global and local Bayesian hierarchical models","text":"R package available github.com/AlkemaLab/localhierarchy (Alkema et al. 2025). code distributed MIT License. See R package’s LICENSE file details.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/articles/localhierarchy_article.html","id":"grant-information","dir":"Articles","previous_headings":"Conclusions","what":"Grant information","title":"[Article] localhierarchy: an R package to facilitate fitting of global and local Bayesian hierarchical models","text":"work supported, whole part, Gates Foundation (INV-00844 OPP1192802). grant conditions Foundation, Creative Commons Attribution 4.0 Generic License already assigned Author Accepted Manuscript version might arise submission.","code":""},{"path":[]},{"path":"https://alkemalab.github.io/localhierarchy/articles/localhierarchy_article.html","id":"appendix-i-excerpts-from-the-stan-model","dir":"Articles","previous_headings":"Appendix","what":"Appendix I: Excerpts from the Stan model","title":"[Article] localhierarchy: an R package to facilitate fitting of global and local Bayesian hierarchical models","text":"Stan model used global local models. Excerpts given section explain key components. first excerpt starts end terms model specification concerns specification hierarchical parameters μc\\mu_c, using localhierarchy Stan function get_mu: use (μ1(country),...,μC(country))=M⋅(η1,...,ηC)(\\mu_1^{(country)}, ..., \\mu_C^{(country)}) = M \\cdot (\\eta_1, ..., \\eta_C), matrix MM sparse matrix 1s 0s, (η1,...,ηc)(\\eta_1, ..., \\eta_c) refers vector products standard deviation γ\\gamma terms. function get_mu calculates vector μc(country)\\mu_c^{(country)}s vector η\\etas (mu_star Stan model) decomposition MM different parts UU, VV, WW. implementation uses sparse representation model matrix MM Stan functions csr_matrix_times_vector crs_extract. second Stan model excerpt concerns specification η\\etas (mu_star). vector obtained multiplying parameter vector γ\\gammas, referred mu_raw Stan model respective standard deviation, .e.,  parameter vector stacked σ\\sigmas (labeled mu_sigma Stan model). model block contains prior γ\\gammas σk\\sigma_{k}s, given γ(k)∼N(0,1),σk∼Half-Normal(0,w0,μ),\\begin{align*}   \\gamma^{(k)} &\\sim N(0,1),\\\\   \\sigma_{k} &\\sim \\text{Half-Normal}(0, w_{0, \\mu}), \\end{align*} w0,μw_{0, \\mu} refers prior standard deviation σk\\sigma_k, called prior_sd_sigma_estimate Stan model file. localhierarchy Stan function get_mu_star used carry multiplication obtain η\\etas. arguments get_mu_star include prior parameters m0,μm_{0, \\mu}, mu_scalarprior_mean, s0,μs_{0, \\mu}, mu_scalarprior_sd, refer (rescaled) prior mean standard deviation μ(global)\\mu^{(\\mathrm{global})}, μ(global)=s0,μ(m0,μ+γ(global))\\mu^{(\\mathrm{global})} = s_{0, \\mu}(m_{0, \\mu} + \\gamma^{(\\mathrm{global})}). Combined standard normal prior γ(global)\\gamma^{(\\mathrm{global})}, resulting prior intercept μ(global)\\mu^{(\\mathrm{global})} given : μ(global)∼N(s0,μ⋅m0,μ,s0,μ).\\begin{align*}   \\mu^{(\\mathrm{global})} &\\sim N(s_{0, \\mu}\\cdot m_{0, \\mu}, s_{0, \\mu}). \\end{align*} prior parameters (m0,μ,s0,μ,w0,μm_{0, \\mu}, s_{0, \\mu}, w_{0, \\mu}) added input data Stan model. allow global local models, additions _estimate _fixed used allow splitting mu_raw vector two parts, one fixed one estimated parameters. Similarly, vector mu_sigma also split two parts, one part fixed one part estimated parameters. Relevant Stan code follows:","code":"data {   matrix[n_geounit, mu_raw_n_terms] mu_model_matrix; }  transformed data {   vector[rows(csr_extract_w(mu_model_matrix))] mu_model_matrix_w                    = csr_extract_w(mu_model_matrix);   array[size(csr_extract_v(mu_model_matrix))] int mu_model_matrix_v                 = csr_extract_v(mu_model_matrix);   array[size(csr_extract_u(mu_model_matrix))] int mu_model_matrix_u                 = csr_extract_u(mu_model_matrix); }  transformed parameters {  vector[n_geounit] mu = get_mu(     mu_star,     mu_raw_n_terms,     n_geounit,     mu_model_matrix_w, mu_model_matrix_v, mu_model_matrix_u); } data {   // terms of hierarchical model   int<lower=0> mu_raw_n_terms;   int<lower=0> mu_raw_n_terms_fixed;   int<lower=0> mu_raw_n_terms_estimate;   int<lower=0> mu_n_sigma;   int<lower=0> mu_n_sigma_fixed;   int<lower=0> mu_n_sigma_estimate;   array[mu_n_sigma + 1] int<lower=1, upper=mu_raw_n_terms> mu_re_start;   array[mu_n_sigma + 1] int<lower=1, upper=mu_raw_n_terms> mu_re_end;   // values of fixed parameters   vector[mu_raw_n_terms_fixed] mu_raw_fixed;   vector<lower=verysmallnumber>[mu_n_sigma_fixed] mu_sigma_fixed;   // prior parameters   real<lower = verysmallnumber> mu_scalarprior_sd;   real mu_scalarprior_mean;   real<lower = verysmallnumber> mu_prior_sd_sigma_estimate; }  parameters {   vector[mu_raw_n_terms_estimate] mu_raw_estimate;   vector<lower=verysmallnumber>[mu_n_sigma_estimate] mu_sigma_estimate; }  transformed parameters {  vector[mu_raw_n_terms] mu_star = get_mu_star(     mu_n_sigma, mu_n_sigma_fixed, mu_n_sigma_estimate,     mu_sigma_fixed, mu_sigma_estimate,     mu_scalarprior_mean,     mu_scalarprior_sd,     mu_raw_n_terms, mu_raw_n_terms_fixed, mu_raw_n_terms_estimate,     mu_raw_fixed, mu_raw_estimate,     mu_re_start, mu_re_end); } model {   to_vector(mu_raw_estimate) ~ std_normal();   to_vector(mu_sigma_estimate) ~ normal(0, mu_prior_sd_sigma_estimate); }"},{"path":[]},{"path":"https://alkemalab.github.io/localhierarchy/articles/localhierarchy_article.html","id":"details","dir":"Articles","previous_headings":"Appendix > Appendix II: Documentation of the fit_model_localhierarchy function","what":"Details","title":"[Article] localhierarchy: an R package to facilitate fitting of global and local Bayesian hierarchical models","text":"fit_model_localhierarchy function fits toy example hierarchical models/seq fitting. argument runstep determines type run perform. following run steps supported: “global_national”: Fit global model. “local_national”: Fit model data single country, using global_national fit. “global_subnational”: Fit model global database subnational data, using global_national fit. “local_subnational”: Fit model subnational data single country region, using global_subnational fit. also explained documentation folder. Details hierarchical set ups used package allows structure hierarchical prior configured user hierarchical_level argument. arguments expect character vector specifies nesting hierarchical structure. element vector must either “intercept” column name survey dataset, “intercept” add global intercept parameter. vector must descending order terms hierarchy: , starts “intercept” proceeds hierarchy. example, suppose fitting country-level data, dataset columns “name_country”, “name_sub_region”, “name_region” containing name country, sub-region, region observation belongs . specify parameter mu fitted hierarchical model countries nested within sub-regions within regions within world, use argument hierarchical_level = c(\"intercept\", \"name_region\", \"name_sub_region\", \"name_country\"). Optionally, model parameters can fixed values previous model fit provided via global_fit argument. typical use case, global_fit fit data many geographic units (e.g., countries), current fit uses data smaller number locations. using global_fit fix parameter values, exactly fixed determined runstep global_fit combi. see options function","code":""},{"path":"https://alkemalab.github.io/localhierarchy/articles/localhierarchy_article.html","id":"value","dir":"Articles","previous_headings":"Appendix > Appendix II: Documentation of the fit_model_localhierarchy function","what":"Value","title":"[Article] localhierarchy: an R package to facilitate fitting of global and local Bayesian hierarchical models","text":"List contains samples, stan_data, information relevant model fit (arguments), global fits, point estimates relevant parameters (post_summ). subnational global fits, list includes fit_globalsubnat_fromnat, global fit additional subnational sigmas added postsum object.","code":""},{"path":[]},{"path":"https://alkemalab.github.io/localhierarchy/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Leontine Alkema. Author, maintainer. Shauna Mooney. Author. Evan Ray. Author. Herbert Susmann. Author.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Alkema L, Mooney S, Ray E, Susmann H (2025). localhierarchy: R package facilitate fitting global local Bayesian hierarchical models. R package version 0.9, https://alkemalab.github.io/localhierarchy/.","code":"@Manual{,   title = {localhierarchy: An R package to facilitate fitting of global and local Bayesian hierarchical models},   author = {Leontine Alkema and Shauna Mooney and Evan Ray and Herbert Susmann},   year = {2025},   note = {R package version 0.9},   url = {https://alkemalab.github.io/localhierarchy/}, }"},{"path":[]},{"path":"https://alkemalab.github.io/localhierarchy/index.html","id":"background","dir":"","previous_headings":"","what":"Background","title":"An R package to facilitate fitting of global and local Bayesian hierarchical models","text":"Bayesian hierarchical models widely used global health estimation, data availability may vary across national subnational populations. models typically fitted global database, e.g., produce national-level estimates countries world region. facilitate analysis local level, models often desirable informed global models can fitted just subset data, data one country. refer models local models: models derived global hierarchical models adapted can fitted data one population alone. localhierarchy R package provides functionality fitting Bayesian hierarchical models settings global local estimation required. package provides R functions Stan model components support global modeling, parameters hierarchical models estimated, local modeling, parameters estimated one small number populations, using fixed values global model fit. article website presents practical introduction package applied user illustrates package’s functionality examples national estimation.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"An R package to facilitate fitting of global and local Bayesian hierarchical models","text":"localhierarchy depends cmdstanr: Instructions installing cmdstanr available Getting started guide. Install localhierarchy Github: remotes::install_github(\"AlkemaLab/localhierarchy\")","code":""},{"path":"https://alkemalab.github.io/localhierarchy/index.html","id":"examples","dir":"","previous_headings":"","what":"Examples","title":"An R package to facilitate fitting of global and local Bayesian hierarchical models","text":"See article.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/index.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"An R package to facilitate fitting of global and local Bayesian hierarchical models","text":"Please cite follows:","code":"citation(\"localhierarchy\") #> To cite package 'localhierarchy' in publications use: #>  #>   Alkema L, Mooney S, Ray E, Susmann H (2025). _localhierarchy: An R #>   package to facilitate fitting of global and local Bayesian #>   hierarchical models_. R package version 0.9, #>   <https://alkemalab.github.io/localhierarchy/>. #>  #> A BibTeX entry for LaTeX users is #>  #>   @Manual{, #>     title = {localhierarchy: An R package to facilitate fitting of global and local Bayesian #> hierarchical models}, #>     author = {Leontine Alkema and Shauna Mooney and Evan Ray and Herbert Susmann}, #>     year = {2025}, #>     note = {R package version 0.9}, #>     url = {https://alkemalab.github.io/localhierarchy/}, #>   }"},{"path":"https://alkemalab.github.io/localhierarchy/reference/check_nas.html","id":null,"dir":"Reference","previous_headings":"","what":"Check for missing values — check_nas","title":"Check for missing values — check_nas","text":"function checks NAs specified column data frame.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/check_nas.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Check for missing values — check_nas","text":"","code":"check_nas(data, column)"},{"path":"https://alkemalab.github.io/localhierarchy/reference/check_nas.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Check for missing values — check_nas","text":"data tibble data frame column column check NAs","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/check_nas.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Check for missing values — check_nas","text":"stops NAs column column exist","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/create_a_matrix.html","id":null,"dir":"Reference","previous_headings":"","what":"Create a matrix — create_a_matrix","title":"Create a matrix — create_a_matrix","text":"function takes postsumm object returns matrix relevant information","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/create_a_matrix.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create a matrix — create_a_matrix","text":"","code":"create_a_matrix(post_summ)"},{"path":"https://alkemalab.github.io/localhierarchy/reference/create_a_matrix.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create a matrix — create_a_matrix","text":"post_summ tibble columns variable postmean, variable examples [1,1], [2,1], etc.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/create_a_matrix.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create a matrix — create_a_matrix","text":"matrix rows columns corresponding indices variable","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/extract_parameter_subhierarchical.html","id":null,"dir":"Reference","previous_headings":"","what":"extract_parameter_subhierarchical — extract_parameter_subhierarchical","title":"extract_parameter_subhierarchical — extract_parameter_subhierarchical","text":"extract_parameter_subhierarchical","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/extract_parameter_subhierarchical.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"extract_parameter_subhierarchical — extract_parameter_subhierarchical","text":"","code":"extract_parameter_subhierarchical(   hierarchical_data,   subhierarchy,   parname,   star_samples,   morethan1param = FALSE,   add_standardizedmu = FALSE )"},{"path":"https://alkemalab.github.io/localhierarchy/reference/extract_parameter_subhierarchical.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"extract_parameter_subhierarchical — extract_parameter_subhierarchical","text":"hierarchical_data hierarchical_data, obtained hierarchical_data(fit$geo_unit, fit$hierarchical_level) subhierarchy selected hierarchical_level (example: \"intercept\" \"region\") parname selected parameter name (example: \"mu\") star_samples samples fit$samples parname_star morethan1param parname refer 1 parameter (vector)","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/extract_parameter_subhierarchical.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"extract_parameter_subhierarchical — extract_parameter_subhierarchical","text":"tibble posterior samples selected parameter mu subhierarchy level. mus obtained summing relevant etas variables name, value, .draw/iteration/chain' k` referring parameter index morethan1param = TRUE","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/fit_model_localhierarchy.html","id":null,"dir":"Reference","previous_headings":"","what":"Fit localhierarchy example model — fit_model_localhierarchy","title":"Fit localhierarchy example model — fit_model_localhierarchy","text":"function fits localhierarchy example model","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/fit_model_localhierarchy.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Fit localhierarchy example model — fit_model_localhierarchy","text":"","code":"fit_model_localhierarchy(   survey_df,   y = \"y\",   area = \"iso\",   area_select = NULL,   runstep,   global_fit = NULL,   hierarchical_level = c(\"intercept\", \"subcluster\", \"iso\"),   add_subnational_hierarchy = \"subnat\",   use_globalsubnat_fromnat = TRUE,   mu_isvector = FALSE,   chains = 4,   iter_sampling = 300,   iter_warmup = 150,   compile_model = TRUE,   force_recompile = FALSE,   seed = 1234,   refresh = 200,   adapt_delta = 0.9,   max_treedepth = 14 )"},{"path":"https://alkemalab.github.io/localhierarchy/reference/fit_model_localhierarchy.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Fit localhierarchy example model — fit_model_localhierarchy","text":"survey_df tibble survey data y column name outcome, defaults y. area column name area observation (used geounit; iso subnational region) area_select area name use local run (eg iso code subnat region name) runstep Type run, defines model fitting step perform (see Details options). global_fit optional global fit object, used obtain fixed values use parameters current fit (see Details). hierarchical_level vector specifying hierarchical structure used mu add_subnational_hierarchy level added hierarchy subnational, defaults subnat use_globalsubnat_fromnat Logical, whether local subnational run, use global fit derived national data TRUE local subnat run, global_fit needs contain object fit_globalsubnat_fromnat mu_isvector Logical, TRUE mu vector, defaults FALSE Settings sampling chains number chains run iter_sampling number posterior samples draw iter_warmup number warmup iterations compile_model boolean indicator whether compile Stan model force_recompile boolean indicator whether force recompilation Stan model seed random seed refresh number iterations progress updates adapt_delta target acceptance rate -U-Turn Sampler max_treedepth maximum tree depth -U-Turn Sampler","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/fit_model_localhierarchy.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Fit localhierarchy example model — fit_model_localhierarchy","text":"List contains samples, stan_data, information relevant model fit (arguments), global fits, point estimates relevant parameters (post_summ). subnational global fits, list includes fit_globalsubnat_fromnat, global fit additional subnational sigmas added postsum object.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/fit_model_localhierarchy.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Fit localhierarchy example model — fit_model_localhierarchy","text":"fit_model_localhierarchy function fits toy example hierarchical models/seq fitting. argument runstep determines type run perform. following run steps supported: \"global_national\": Fit global model. \"local_national\": Fit model data single country, using global_national fit. \"global_subnational\": Fit model global database subnational data, using global_national fit (NISE modeling). \"local_subnational\": Fit model subnational data single country region, using global_subnational fit. options also explained article package. Details hierarchical set ups used package allows structure hierarchical prior configured user  hierarchical_level argument. arguments expect character vector specifies nesting hierarchical structure. element vector must either \"intercept\" column name survey dataset, \"intercept\" add global intercept parameter. vector must descending order terms hierarchy: , starts \"intercept\" proceeds hierarchy. example, suppose fitting country-level data, dataset columns \"name_country\", \"name_sub_region\", \"name_region\" containing name country, sub-region, region observation belongs . specify parameter mu fitted hierarchical model countries nested within sub-regions within regions within world, use argument hierarchical_level = c(\"intercept\", \"name_region\", \"name_sub_region\", \"name_country\"). Optionally, model parameters can fixed values previous model fit provided via global_fit argument. typical use case, global_fit fit data many geographic units (e.g., countries), current fit uses data smaller number locations. using global_fit fix parameter values, exactly fixed determined runstep global_fit combi.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/get_geo_unit_index_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Get unique hierarchical levels from survey data — get_geo_unit_index_data","title":"Get unique hierarchical levels from survey data — get_geo_unit_index_data","text":"Get unique hierarchical levels survey data assign index \"c\" based area.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/get_geo_unit_index_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get unique hierarchical levels from survey data — get_geo_unit_index_data","text":"","code":"get_geo_unit_index_data(data, hierarchical_levels, area)"},{"path":"https://alkemalab.github.io/localhierarchy/reference/get_geo_unit_index_data.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get unique hierarchical levels from survey data — get_geo_unit_index_data","text":"data survey data interest contains hierarchical_column_names hierarchical_levels vector contains one specs hierarchical_level (incl intercept) area unit analysis (eg country subnational region)","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/get_geo_unit_index_data.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get unique hierarchical levels from survey data — get_geo_unit_index_data","text":"tibble unique hierarchical levels (one column level) index \"c\" assigned based area","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/get_geo_unit_index_data.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Get unique hierarchical levels from survey data — get_geo_unit_index_data","text":"","code":"survey_dat <- tibble::tibble(subcluster = c(\"A\", \"A\", \"B\", \"B\"),     iso = c(\"iso1\", \"iso2\", \"iso3\", \"iso4\")) get_geo_unit_index_data(survey_dat,         hierarchical_levels = c(\"intercept\", \"subcluster\", \"iso\"),         area = \"iso\") #> # A tibble: 4 × 3 #>   subcluster iso       c #>   <chr>      <chr> <int> #> 1 A          iso1      1 #> 2 A          iso2      2 #> 3 B          iso3      3 #> 4 B          iso4      4"},{"path":"https://alkemalab.github.io/localhierarchy/reference/get_mu_raw_labeled.html","id":null,"dir":"Reference","previous_headings":"","what":"Get mu_raw_labeled — get_mu_raw_labeled","title":"Get mu_raw_labeled — get_mu_raw_labeled","text":"function extracts mu_raw_estimate samples fitted model labels hierarchical level.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/get_mu_raw_labeled.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get mu_raw_labeled — get_mu_raw_labeled","text":"","code":"get_mu_raw_labeled(fit, parname, morethan1param = FALSE)"},{"path":"https://alkemalab.github.io/localhierarchy/reference/get_mu_raw_labeled.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get mu_raw_labeled — get_mu_raw_labeled","text":"fit needs include parname_raw_estimate (example: mu_raw) parname selected parameter name (example: mu) morethan1param parname refer 1 parameter (vector)","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/get_mu_raw_labeled.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get mu_raw_labeled — get_mu_raw_labeled","text":"tibble samples parname_raw_estimate, including info hierarchical level","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/get_posterior_summaries_localhierarchy.html","id":null,"dir":"Reference","previous_headings":"","what":"Get posterior summaries for use in local models — get_posterior_summaries_localhierarchy","title":"Get posterior summaries for use in local models — get_posterior_summaries_localhierarchy","text":"Get posterior summaries set parameters use local model","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/get_posterior_summaries_localhierarchy.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get posterior summaries for use in local models — get_posterior_summaries_localhierarchy","text":"","code":"get_posterior_summaries_localhierarchy(   fit,   params = c(\"mu_raw\", \"mu_sigma\", \"nonse\") )"},{"path":"https://alkemalab.github.io/localhierarchy/reference/get_posterior_summaries_localhierarchy.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get posterior summaries for use in local models — get_posterior_summaries_localhierarchy","text":"fit fit object summarize params vector parnames summarize (w/o index)","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/get_posterior_summaries_localhierarchy.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get posterior summaries for use in local models — get_posterior_summaries_localhierarchy","text":"tibble variable (parname index used model) postmean (posterior mean)","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/get_posterior_summary_one_param.html","id":null,"dir":"Reference","previous_headings":"","what":"get_posterior_summary_one_param — get_posterior_summary_one_param","title":"get_posterior_summary_one_param — get_posterior_summary_one_param","text":"Get posterior summary one parameter","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/get_posterior_summary_one_param.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"get_posterior_summary_one_param — get_posterior_summary_one_param","text":"","code":"get_posterior_summary_one_param(fit, param_name)"},{"path":"https://alkemalab.github.io/localhierarchy/reference/get_posterior_summary_one_param.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"get_posterior_summary_one_param — get_posterior_summary_one_param","text":"fit fit object param_name parameter name w/o index need get estimate /fixed value indexed parameter difficulty = stacking estimate top fixed values (vector array) note get hierarchical info (hier nonhier param) just stacking","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/get_posterior_summary_one_param.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"get_posterior_summary_one_param — get_posterior_summary_one_param","text":"tibble variable (parname index used model) postmean (posterior mean)","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/hierarchical_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Create hierarchical data structure for a hierarchical model. — hierarchical_data","title":"Create hierarchical data structure for a hierarchical model. — hierarchical_data","text":"Create hierarchical data structure hierarchical model.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/hierarchical_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create hierarchical data structure for a hierarchical model. — hierarchical_data","text":"","code":"hierarchical_data(geo_unit_index_data, hierarchical_level)"},{"path":"https://alkemalab.github.io/localhierarchy/reference/hierarchical_data.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create hierarchical data structure for a hierarchical model. — hierarchical_data","text":"geo_unit_index_data tibble unique hierarchical levels (one column level) hierarchical_level vector hierarchical spec","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/hierarchical_data.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create hierarchical data structure for a hierarchical model. — hierarchical_data","text":"list model matrix info start end indices associated different levels","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/hierarchical_model_matrix.html","id":null,"dir":"Reference","previous_headings":"","what":"Hierarchical model matrix — hierarchical_model_matrix","title":"Hierarchical model matrix — hierarchical_model_matrix","text":"Create list information including model matrix, associated geo_unit_data hierarchical_levels","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/hierarchical_model_matrix.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Hierarchical model matrix — hierarchical_model_matrix","text":"","code":"hierarchical_model_matrix(geo_unit_index_data, hierarchical_level)"},{"path":"https://alkemalab.github.io/localhierarchy/reference/hierarchical_model_matrix.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Hierarchical model matrix — hierarchical_model_matrix","text":"geo_unit_index_data tibble unique hierarchical levels (one column level, one row per combi) hierarchical_level vector hierarchical spec highest lowest levels","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/hierarchical_model_matrix.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Hierarchical model matrix — hierarchical_model_matrix","text":"list components modelmatrix, assign, index: modelmatrix: matrix column refers one eta (number rows equals number lowest level units). assign: Integer vector length equal number etas; 0 intercept, hierarchical level index (starting 2) eta level. index: tibble n_eta rows, columns: : Index eta column: Hierarchical level level: Name hierarchical level components associated provided geo_unit_data hierarchical_levels.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/hierarchical_param_stan_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Stan data for hierarchical parameters — hierarchical_param_stan_data","title":"Stan data for hierarchical parameters — hierarchical_param_stan_data","text":"Set data Stan related hierarchical parameters","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/hierarchical_param_stan_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Stan data for hierarchical parameters — hierarchical_param_stan_data","text":"","code":"hierarchical_param_stan_data(   param_name,   param_data,   global_fit = NULL,   hierarchical_terms_fixed,   hierarchical_sigmas_fixed )"},{"path":"https://alkemalab.github.io/localhierarchy/reference/hierarchical_param_stan_data.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Stan data for hierarchical parameters — hierarchical_param_stan_data","text":"param_name name parameter working , e.g. \"mu\" param_data Data structures constructed hierarchical_data parameter global_fit optional \"global\" fit used extract parameter estimates specified hierarchical units fix. Defaults NULL, fixing. hierarchical_terms_fixed character vector specifying hierarchical levels terms fixed (subset hierarchical_levels). Used global fit provided. hierarchical_sigmas_fixed character vector specifying hierarchical levels terms fixed (subset hierarchical_levels, intercept always included) Used global fit provided.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/hierarchical_param_stan_data.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Stan data for hierarchical parameters — hierarchical_param_stan_data","text":"named list Stan data relevant hierarchical set parameter, e.g. param_name \"mu\", mu_n_terms, mu_n_sigma, mu_re_start, mu_re_end, mu_model_matrix, mu_n_terms_fixed, mu_n_terms_estimate, mu_raw_fixed, mu_n_sigma_fixed, mu_n_sigma_estimate, mu_sigma_fixed","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/init_fun_localhierarchy.html","id":null,"dir":"Reference","previous_headings":"","what":"Set initial values — init_fun_localhierarchy","title":"Set initial values — init_fun_localhierarchy","text":"function sets initial values parameters simple hierarchical model.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/init_fun_localhierarchy.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Set initial values — init_fun_localhierarchy","text":"","code":"init_fun_localhierarchy(chain_id, stan_data)"},{"path":"https://alkemalab.github.io/localhierarchy/reference/init_fun_localhierarchy.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Set initial values — init_fun_localhierarchy","text":"chain_id chain ID, used setting seed stan_data list containing Stan data, obtain length parameter vectors","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/init_fun_localhierarchy.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Set initial values — init_fun_localhierarchy","text":"list initial values model parameters","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/is_there_a_comma.html","id":null,"dir":"Reference","previous_headings":"","what":"Is there a comma? — is_there_a_comma","title":"Is there a comma? — is_there_a_comma","text":"comma?","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/is_there_a_comma.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Is there a comma? — is_there_a_comma","text":"","code":"is_there_a_comma(variable)"},{"path":"https://alkemalab.github.io/localhierarchy/reference/is_there_a_comma.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Is there a comma? — is_there_a_comma","text":"variable character string checked comma","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/is_there_a_comma.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Is there a comma? — is_there_a_comma","text":"Boolean","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/localhierarchy-package.html","id":null,"dir":"Reference","previous_headings":"","what":"localhierarchy: An R package to facilitate fitting of global and local Bayesian hierarchical models — localhierarchy-package","title":"localhierarchy: An R package to facilitate fitting of global and local Bayesian hierarchical models — localhierarchy-package","text":"LocalHierarchy package implements flexible set estimate parameters hierarchically carry local model fits, whereby higher-level parameters fixed.","code":""},{"path":[]},{"path":"https://alkemalab.github.io/localhierarchy/reference/localhierarchy-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"localhierarchy: An R package to facilitate fitting of global and local Bayesian hierarchical models — localhierarchy-package","text":"Maintainer: Leontine Alkema lalkema@umass.edu Authors: Shauna Mooney Evan Ray Herbert Susmann herbps10@gmail.com","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/param_array_to_indexed_df.html","id":null,"dir":"Reference","previous_headings":"","what":"Starting from an array of parameter values (of dimension 1 or 2), create a data frame with columns variable with the combined parameter name and indices, and mean with the parameter values — param_array_to_indexed_df","title":"Starting from an array of parameter values (of dimension 1 or 2), create a data frame with columns variable with the combined parameter name and indices, and mean with the parameter values — param_array_to_indexed_df","text":"Starting array parameter values (dimension 1 2), create data frame columns variable combined parameter name indices, mean parameter values","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/param_array_to_indexed_df.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Starting from an array of parameter values (of dimension 1 or 2), create a data frame with columns variable with the combined parameter name and indices, and mean with the parameter values — param_array_to_indexed_df","text":"","code":"param_array_to_indexed_df(param_values, num_inds, n, m, param_name)"},{"path":"https://alkemalab.github.io/localhierarchy/reference/param_array_to_indexed_df.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Starting from an array of parameter values (of dimension 1 or 2), create a data frame with columns variable with the combined parameter name and indices, and mean with the parameter values — param_array_to_indexed_df","text":"param_values Parameter values num_inds Dimension (1 2) n Number indices m dimension 2, number indices 2nd dimension param_name Parameter name","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/param_array_to_indexed_df.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Starting from an array of parameter values (of dimension 1 or 2), create a data frame with columns variable with the combined parameter name and indices, and mean with the parameter values — param_array_to_indexed_df","text":"Data frame columns variable combined parameter name indices, mean parameter values","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/plot_muraw_localhierarchy.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot prior and posterior densities of location parameters — plot_muraw_localhierarchy","title":"Plot prior and posterior densities of location parameters — plot_muraw_localhierarchy","text":"function plots posterior densities location (mu_raw) parameters, priors added.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/plot_muraw_localhierarchy.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot prior and posterior densities of location parameters — plot_muraw_localhierarchy","text":"","code":"plot_muraw_localhierarchy(   fit,   parname,   morethan1param = FALSE,   nresultsperpage = 30 )"},{"path":"https://alkemalab.github.io/localhierarchy/reference/plot_muraw_localhierarchy.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot prior and posterior densities of location parameters — plot_muraw_localhierarchy","text":"fit List includes \"parname\"_raw_estimate stan_data parname Selected parameter name (example: mu) morethan1param Logical, parname refer 1 parameter (vector) nresultsperpage Number results per page summary plots","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/plot_muraw_localhierarchy.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plot prior and posterior densities of location parameters — plot_muraw_localhierarchy","text":"lists list 'summary_plots' list 'plots_allmuraw'. summary plots gives summary CIs, nresultsperpage time. plots_allmuraw gives individual plots mu_raw, density per chain prior added morethan1param = TRUE, list contains list per parameter k","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/plot_posterior_summaries_localhierarchy.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot summaries of hierarchical parameters — plot_posterior_summaries_localhierarchy","title":"Plot summaries of hierarchical parameters — plot_posterior_summaries_localhierarchy","text":"Display outputs posterior_summary_hierparam_localhierarchy","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/plot_posterior_summaries_localhierarchy.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot summaries of hierarchical parameters — plot_posterior_summaries_localhierarchy","text":"","code":"plot_posterior_summaries_localhierarchy(   res,   hierarchy_select = NULL,   areas_select = NULL,   res2 = NULL,   modelname1 = \"model 1\",   modelname2 = \"model 2\",   k_select = NULL,   dodge = position_dodge(width = 0.5) )"},{"path":"https://alkemalab.github.io/localhierarchy/reference/plot_posterior_summaries_localhierarchy.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot summaries of hierarchical parameters — plot_posterior_summaries_localhierarchy","text":"res output posterior_summary_hierparam_localhierarchy hierarchy_select optional, hierarchical level show? NULL, levels shown areas_select optional: specific areas level filter , allowed one hierarchical level selected res2 optional, output posterior_summary_hierparam_localhierarchy comparison modelname1 label res modelname2 label res2 k_select optional, res contains k, k values show? NULL, k values shown dodge used offsetting plots, default 0.5","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/plot_posterior_summaries_localhierarchy.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plot summaries of hierarchical parameters — plot_posterior_summaries_localhierarchy","text":"ggplot object","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/plot_prior_post_sigmas_localhierarchy.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot prior and posteriors of sigmas from hierarchical models — plot_prior_post_sigmas_localhierarchy","title":"Plot prior and posteriors of sigmas from hierarchical models — plot_prior_post_sigmas_localhierarchy","text":"function plots prior posterior densities sigma_estimate parameters.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/plot_prior_post_sigmas_localhierarchy.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot prior and posteriors of sigmas from hierarchical models — plot_prior_post_sigmas_localhierarchy","text":"","code":"plot_prior_post_sigmas_localhierarchy(fit, parname)"},{"path":"https://alkemalab.github.io/localhierarchy/reference/plot_prior_post_sigmas_localhierarchy.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot prior and posteriors of sigmas from hierarchical models — plot_prior_post_sigmas_localhierarchy","text":"fit List, needs include parname_sigma_estimate stan_data parname Selected parameter name (example: \"mu\")","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/plot_prior_post_sigmas_localhierarchy.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plot prior and posteriors of sigmas from hierarchical models — plot_prior_post_sigmas_localhierarchy","text":"Plot density sigma_estimate prior added","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/posterior_summary_hierparam_localhierarchy.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate posterior summaries for hierarchical parameters — posterior_summary_hierparam_localhierarchy","title":"Calculate posterior summaries for hierarchical parameters — posterior_summary_hierparam_localhierarchy","text":"Calculate posterior summaries hierarchical parameters","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/posterior_summary_hierparam_localhierarchy.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate posterior summaries for hierarchical parameters — posterior_summary_hierparam_localhierarchy","text":"","code":"posterior_summary_hierparam_localhierarchy(   fit,   parname,   morethan1param = FALSE,   hierarchical_levels = fit$hierarchical_level )"},{"path":"https://alkemalab.github.io/localhierarchy/reference/posterior_summary_hierparam_localhierarchy.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate posterior summaries for hierarchical parameters — posterior_summary_hierparam_localhierarchy","text":"fit needs include parname_star parname selected parameter name (example: \"mu\") morethan1param paramname refer 1 parameter (vector) hierarchical_levels specifies names hierarchical levels (defaults fit$hierarchical_level)","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/posterior_summary_hierparam_localhierarchy.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate posterior summaries for hierarchical parameters — posterior_summary_hierparam_localhierarchy","text":"list summaries mu hierarchical level (units level) mus obtained summing relevant etas morethan1param, level list k refers index","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/quantile_df.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute quantiles — quantile_df","title":"Compute quantiles — quantile_df","text":"function computes quantiles given vector returns tibble format.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/quantile_df.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute quantiles — quantile_df","text":"","code":"quantile_df(x, probs = c(0.025, 0.5, 0.975))"},{"path":"https://alkemalab.github.io/localhierarchy/reference/quantile_df.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute quantiles — quantile_df","text":"x vector values probs vector quantiles","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/quantile_df.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute quantiles — quantile_df","text":"tibble requested quantiles","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/simulate_multilevel_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Simulate multilevel data — simulate_multilevel_data","title":"Simulate multilevel data — simulate_multilevel_data","text":"Simulates nested multilevel data structure. Lowest level can used observational error.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/simulate_multilevel_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Simulate multilevel data — simulate_multilevel_data","text":"","code":"simulate_multilevel_data(   n_levels = 3,   n_units_perlevel = rep(25, n_levels),   sigma_perlevel = rep(1, n_levels),   mu_global = 0,   add_data = TRUE,   n_data = 10,   sigma_y = 0.05,   add_data1levelup = FALSE,   seed = 12345 )"},{"path":"https://alkemalab.github.io/localhierarchy/reference/simulate_multilevel_data.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Simulate multilevel data — simulate_multilevel_data","text":"n_levels Number hierarchical levels (default: 3). n_units_perlevel vector specifying number units level (default: rep(25, n_levels)). sigma_perlevel vector specifying standard deviation etas level (default: rep(1, n_levels)). mu_global Global mean outcome variable (default: 0). add_data Logical indicating whether add observations (default: TRUE). TRUE, adds column y. n_data Number observations add lowest level (default: 10). sigma_y Standard deviation added observations (default: 0.05) add_data1levelup Logical indicating whether add observations one level e.g. national level lowest level subnational (default: FALSE). seed Random seed reproducibility (default: 1234).","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/simulate_multilevel_data.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Simulate multilevel data — simulate_multilevel_data","text":"tibble columns level, mu_global, etas, total labeled y","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/split_var_name_and_index.html","id":null,"dir":"Reference","previous_headings":"","what":"Split variable name and index — split_var_name_and_index","title":"Split variable name and index — split_var_name_and_index","text":"data frame estimates column contains combined info variable name row /column indices, add columns containing just variable name indices.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/split_var_name_and_index.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Split variable name and index — split_var_name_and_index","text":"","code":"split_var_name_and_index(estimate_df, num_inds)"},{"path":"https://alkemalab.github.io/localhierarchy/reference/split_var_name_and_index.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Split variable name and index — split_var_name_and_index","text":"estimate_df data frame column called variable contains parname[] parname[,j] entries num_inds number indices variable name (used 1 2)","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/split_var_name_and_index.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Split variable name and index — split_var_name_and_index","text":"data frame columns estimate_df plus columns containing just variable name indices.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/summary_df.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute summaries — summary_df","title":"Compute summaries — summary_df","text":"function computes posterior summaries given vector returns tibble format.","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/summary_df.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute summaries — summary_df","text":"","code":"summary_df(x)"},{"path":"https://alkemalab.github.io/localhierarchy/reference/summary_df.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute summaries — summary_df","text":"x vector values","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/summary_df.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute summaries — summary_df","text":"tibble 2.5th quantile, posterior mean, 97.5th quantile, quant = c(0.025, 0.5, 0.975)","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/variable_exists_in_draws.html","id":null,"dir":"Reference","previous_headings":"","what":"Determine whether or not a variable exists in draws from a fit This is similar to the function posterior:::check_existing_variables, but note that function is not exported from posterior — variable_exists_in_draws","title":"Determine whether or not a variable exists in draws from a fit This is similar to the function posterior:::check_existing_variables, but note that function is not exported from posterior — variable_exists_in_draws","text":"Determine whether variable exists draws fit similar function posterior:::check_existing_variables, note function exported posterior","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/variable_exists_in_draws.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Determine whether or not a variable exists in draws from a fit This is similar to the function posterior:::check_existing_variables, but note that function is not exported from posterior — variable_exists_in_draws","text":"","code":"variable_exists_in_draws(fit, var_name)"},{"path":"https://alkemalab.github.io/localhierarchy/reference/variable_exists_in_draws.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Determine whether or not a variable exists in draws from a fit This is similar to the function posterior:::check_existing_variables, but note that function is not exported from posterior — variable_exists_in_draws","text":"fit fpemplus fit object var_name name variable character string","code":""},{"path":"https://alkemalab.github.io/localhierarchy/reference/variable_exists_in_draws.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Determine whether or not a variable exists in draws from a fit This is similar to the function posterior:::check_existing_variables, but note that function is not exported from posterior — variable_exists_in_draws","text":"TRUE FALSE indicating whether variable exists fit.","code":""}]
